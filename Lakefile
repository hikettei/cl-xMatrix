#|-*- mode:lisp -*-|#
(in-package :cl-user)
(defpackage :lake.user
  (:use
   :cl
   :lake
   :cl-syntax)
  (:shadowing-import-from :lake
                          :directory))
(in-package :lake.user)

(defun generate-compile-option ()
  )

(use-syntax :interpol)

(defparameter *compiler* "gcc")

(task "build" () ; Todo: Add Namespace and more compile options
      (sh "gcc -c -fPIC -O3 -mavx2 ./source/kernel/src/xMatrix.c -I./source/kernel/include/xMatrix -o ./source/kernel/src/xMatrix.o")
      (sh "gcc -c -fPIC -O3 -mavx2 ./source/kernel/src/quantize.c -I./source/kernel/include/xMatrix -o ./source/kernel/src/quantize.o")
      (sh "gcc -c -fPIC -O3 -mavx2 ./source/kernel/src/maddness.c -I./source/kernel/include/xMatrix -o ./source/kernel/src/maddness.o")

      (sh "gcc -shared ./source/kernel/src/xMatrix.o ./source/kernel/src/quantize.o ./source/kernel/src/maddness.o -o ./source/kernel/libxMatrix.dylib")
      )

(task "testc" ()
      (sh "gcc -O2 -mavx2 ./source/kernel/tests/arithmetic.c ./source/kernel/src/xMatrix.c -I./source/kernel/include/xMatrix")
      (sh "./a.out")
      )

(task "test" ()
      (sh "gcc -O2 -mavx2 ./source/kernel/src/xMatrix.c -I./source/kernel/include/xMatrix -shared -o ./source/kernel/libxMatrix.dylib")
      (sh "ros ./roswell/xmatrix.ros"))

;;; here follow your tasks...
